import"./token.guard-C10oOflc.js";/* empty css             */import{t as h}from"./formularios_tablas-DeWFMYwk.js";const r="https://agenda-1-zomu.onrender.com/api/v1";async function E(i){const e=await fetch(`${r}/clientes/`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}),t=await e.json();if(!e.ok)throw new Error(t.detail||"Error obteniendo clientes");return t}async function f(i,e){const t=await fetch(`${r}/clientes/`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(i)}),n=await t.json();if(!t.ok)throw new Error(n.detail||"Error creando cliente");return n}async function y(i,e,t){const n=await fetch(`${r}/clientes/${i}`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),o=await n.json();if(!n.ok)throw new Error(o.detail||"Error actualizando cliente");return o}async function p(i,e){const t=await fetch(`${r}/clientes/${i}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok){const n=await t.json();throw new Error(n.detail||"Error eliminando cliente")}return!0}class l{constructor({id:e=null,numeroCliente:t,nombre:n,apellido:o,telefono:s,domicilio:c,numeroDomicilio:m,email:u}){this.id=e,this.numeroCliente=t.trim(),this.nombre=n.trim(),this.apellido=o.trim(),this.telefono=s.trim(),this.domicilio=c.trim(),this.numeroDomicilio=m,this.email=u.trim()}}function a(i){return new l({id:i.id,numeroCliente:i.numero_cliente,nombre:i.nombre,apellido:i.apellido,telefono:i.telefono,domicilio:i.domicilio,numeroDomicilio:i.numero_domicilio,email:i.email})}function d(i){return{numero_cliente:i.numeroCliente,nombre:i.nombre,apellido:i.apellido,telefono:i.telefono,domicilio:i.domicilio,numero_domicilio:Number(i.numeroDomicilio),email:i.email}}async function w(i){return(await E(i)).map(a)}async function v(i,e){const t=d(i),n=await f(t,e);return a(n)}async function b(i,e){const t=d(i),n=await y(i.id,t,e);return a(n)}async function C(i,e){return p(i,e)}class g{constructor({view:e,tokenProvider:t}){this.view=e,this.tokenProvider=t,this.clientes=[],this.clienteEditando=null}async init(){this.bindEvents(),await this.cargarClientes()}bindEvents(){this.view.onSubmit(e=>this.handleGuardar(e)),this.view.onEditar(e=>this.handleEditar(e)),this.view.onEliminar(e=>this.handleEliminar(e))}async cargarClientes(){try{const e=this.tokenProvider.getToken();this.clientes=await w(e),this.view.render(this.clientes)}catch(e){this.view.renderError(e.message)}}async handleGuardar(e){try{const t=this.tokenProvider.getToken(),n=new l({...e,id:this.clienteEditando?.id??null});this.clienteEditando?(await b(n,t),this.clienteEditando=null):await v(n,t),await this.cargarClientes(),this.view.resetForm()}catch(t){this.view.renderError(t.message)}}handleEditar(e){const t=this.clientes.find(n=>n.id===e);t&&(this.clienteEditando=t,this.view.fillForm(t))}async handleEliminar(e){if(confirm("Â¿Eliminar cliente?"))try{const n=this.tokenProvider.getToken();await C(e,n),await this.cargarClientes()}catch(n){this.view.renderError(n.message)}}}class B{constructor(){this.form=document.getElementById("formCliente"),this.tableBody=document.querySelector("#clientesTable tbody")}render(e){this.tableBody.innerHTML="",e.forEach(t=>{const n=document.createElement("tr");n.innerHTML=`
        <td>${t.numeroCliente}</td>
        <td>${t.nombre}</td>
        <td>${t.apellido}</td>
        <td>${t.telefono}</td>
        <td>${t.domicilio} ${t.numeroDomicilio}</td>
        <td>${t.email}</td>
        <td>
          <button data-id="${t.id}" class="edit-btn">âœï¸</button>
          <button data-id="${t.id}" class="delete-btn">ğŸ—‘ï¸</button>
        </td>
      `,this.tableBody.appendChild(n)})}renderError(e){alert(e)}fillForm(e){document.getElementById("NumeroCliente").value=e.numeroCliente,document.getElementById("clienteNombre").value=e.nombre,document.getElementById("clienteApellido").value=e.apellido,document.getElementById("clienteTelefono").value=e.telefono,document.getElementById("clienteDomicilio").value=e.domicilio,document.getElementById("clienteNumeroDomicilio").value=e.numeroDomicilio,document.getElementById("clienteEmail").value=e.email}resetForm(){this.form.reset()}onSubmit(e){this.form.addEventListener("submit",t=>{t.preventDefault(),e({numeroCliente:document.getElementById("NumeroCliente").value,nombre:document.getElementById("clienteNombre").value,apellido:document.getElementById("clienteApellido").value,telefono:document.getElementById("clienteTelefono").value,domicilio:document.getElementById("clienteDomicilio").value,numeroDomicilio:document.getElementById("clienteNumeroDomicilio").value,email:document.getElementById("clienteEmail").value})})}onEditar(e){this.tableBody.addEventListener("click",t=>{const n=t.target.closest(".edit-btn");n&&e(n.dataset.id)})}onEliminar(e){this.tableBody.addEventListener("click",t=>{const n=t.target.closest(".delete-btn");n&&e(n.dataset.id)})}}document.addEventListener("DOMContentLoaded",async()=>{const i=new B;await new g({view:i,tokenProvider:h}).init()});
